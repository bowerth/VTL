 


  <div class="row no-gutters">
    <div class="col-lg-12 col-xl-9 py-3">
            <h1 id="spark-limitations_toc_limitations-of-the-spark-vtl-environment">Limitations of the Spark VTL environment</h1> 
<p>The VTL Spark environment is still under development. As it is, it has several limitations to take into account when moving VTL computations inside Apache Spark™.</p> 
<section> 
 <h2 id="spark-limitations_toc_time-series-and-time-functions">Time series and time functions</h2> 
 <p>The Spark environment doesn’t support any time-series manipulation inside Spark, as Spark does not provide an out-of-the-box API for manipulating time series.</p> 
 <p>When invoking VTL time functions, such as <code>fill_time_series()</code>, the dataset will be materialized in the client machine and the computation will proceed outside Spark.</p> 
</section> 
<section> 
 <h2 id="spark-limitations_toc_dates1">Dates</h2> 
 <p>The VTL Spark environment will map VTL dates using classes in the <code>java.time</code> package. Source data, such as parquet files, that contains serialized instances of the old <code>java.sql.Date</code> and <code>java.sql.Timestamp</code> classes may not be loaded directly.</p> 
 <p>Instead, those files must be translated first, converting all instances of the old classes into instances of the new classes in the <code>java.time</code> package. Note that this is supported only from Apache Spark™ 3.0.0 onwards.</p> 
 <p>Please read about <code>spark.sql.datetime.java8API.enabled</code> configuration parameter on official <a class="externalLink" href="https://spark.apache.org/docs/latest/configuration.html#runtime-sql-configuration">Apache Spark™ SQL documentation</a>.</p> 
</section> 
<section> 
 <h2 id="spark-limitations_toc_time-periods-durations-and-times">Time periods, Durations and Times</h2> 
 <p>The VTL time period, duration and time domains have not been translated to work inside Spark yet. Any dataset containing a component of those domains will cause the engine to crash.</p> 
 <p>Please use VTL <code>cast</code> function to convert those components into some other supported domain.</p> 
</section> 
<section> 
 <h2 id="spark-limitations_toc_codelists-enumerated-subsets-of-string-domain">Codelists (enumerated subsets of string domain)</h2> 
 <p>Code lists may cause some issues when stored in a Spark dataset. Either they will be converted back to simple strings, or cause some other unexpected behaviour.</p> 
</section> 
<section> 
 <h2 id="spark-limitations_toc_parallel-computations">Parallel computations</h2> 
 <p>When processing VTL expressions inside Spark, you may want to disable parallelism, as Spark will parallelize the computation by itself, to reduce the memory consumption and number of Java threads that will be created.</p> 
 <p>You can set the <code>vtl.sequential</code> java system property to <code>true</code> to disable parallelism.</p> 
</section>
        </div>
    <div class="d-none d-sm-none d-md-none d-lg-none d-xl-block col-xl-3">
        <div class="feedback-links">
            <ul class="nav flex-column flex-nowrap">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/vpinna80/VTL/src\site\markdown/spark-limitations.md.vm"><i class="far fa-edit" target="_blank" rel="noopener noreferrer"></i> Improve this page</a>
                </li>
            </ul>
        </div>
            <div id="m-toc-sidebar" class="d-print-none m-toc-sidebar-enabled m-toc-sidebar-expanded m-toc-sidebar-autoexpandable toc-sidebar-fixed">
                <nav id="m-toc-sidebar-nav flex-column">
                <ul class="m-nav--sidebar nav flex-column flex-nowrap">
    <li class="h1">
        <a class="nav-link" href="#spark-limitations_toc_limitations-of-the-spark-vtl-environment" title="Limitations of the Spark VTL environment">Limitations of the Spark VTL environment</a>
    </li>
    <li class="h2">
        <a class="nav-link" href="#spark-limitations_toc_time-series-and-time-functions" title="Time series and time functions">Time series and time functions</a>
    </li>
    <li class="h2">
        <a class="nav-link" href="#spark-limitations_toc_dates1" title="Dates">Dates</a>
    </li>
    <li class="h2">
        <a class="nav-link" href="#spark-limitations_toc_time-periods-durations-and-times" title="Time periods, Durations and Times">Time periods, Durations and Times</a>
    </li>
    <li class="h2">
        <a class="nav-link" href="#spark-limitations_toc_codelists-enumerated-subsets-of-string-domain" title="Codelists (enumerated subsets of string domain)">Codelists (enumerated subsets of string domain)</a>
    </li>
    <li class="h2">
        <a class="nav-link" href="#spark-limitations_toc_parallel-computations" title="Parallel computations">Parallel computations</a>
    </li>
                    </ul>
                </nav>
           </div>
    </div>
</div>
