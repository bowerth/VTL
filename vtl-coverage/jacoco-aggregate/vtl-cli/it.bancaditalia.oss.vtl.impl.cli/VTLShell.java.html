<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../jacoco-resources/report.gif" type="image/gif"/><title>VTLShell.java</title><link rel="stylesheet" href="../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../index.html" class="el_report">vtl-coverage</a> &gt; <a href="../index.html" class="el_bundle">vtl-cli</a> &gt; <a href="index.source.html" class="el_package">it.bancaditalia.oss.vtl.impl.cli</a> &gt; <span class="el_source">VTLShell.java</span></div><h1>VTLShell.java</h1><pre class="source lang-java linenums">/*
 * Copyright Â© 2020 Banca D'Italia
 *
 * Licensed under the EUPL, Version 1.2 (the &quot;License&quot;);
 * You may not use this work except in compliance with the
 * License.
 * You may obtain a copy of the License at:
 *
 * https://joinup.ec.europa.eu/sites/default/files/custom-page/attachment/2020-03/EUPL-1.2%20EN.txt
 *
 * Unless required by applicable law or agreed to in
 * writing, software distributed under the License is
 * distributed on an &quot;AS IS&quot; basis,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
 * express or implied.
 *
 * See the License for the specific language governing
 * permissions and limitations under the License.
 */
package it.bancaditalia.oss.vtl.impl.cli;

import static it.bancaditalia.oss.vtl.config.VTLGeneralProperties.ENVIRONMENT_IMPLEMENTATION;
import static java.util.stream.Collectors.toList;

import java.io.File;
import java.io.FileInputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.nio.charset.StandardCharsets;
import java.util.concurrent.Callable;

import it.bancaditalia.oss.vtl.config.ConfigurationManager;
import it.bancaditalia.oss.vtl.engine.Statement;
import it.bancaditalia.oss.vtl.session.VTLSession;
import picocli.CommandLine;
import picocli.CommandLine.Command;
import picocli.CommandLine.Option;
import picocli.CommandLine.Parameters;

@Command(name = &quot;java -jar vtl-cli.jar&quot;, mixinStandardHelpOptions = true, description = &quot;Parses a set of VTL rules and computes one or more results.&quot;,
		separator = &quot; &quot;)
<span class="nc" id="L42">public class VTLShell implements Callable&lt;Void&gt;</span>
{
	private static final String FILE_DESC = &quot;Input VTL script. If not specified, read from stdin.&quot;;
	private static final String NAMES_DESC = &quot;Rule names whose values will be printed. If none is specified, print the values of all rules.&quot;;
	
	@Option(names = { &quot;-f&quot;, &quot;--file&quot; }, description = FILE_DESC, paramLabel = &quot;file&quot;)
	File file;
	
	@Parameters(description = NAMES_DESC, paramLabel = &quot;rulename&quot;) 
	String[] names;
	
	public static void main(String[] args)
	{
<span class="nc" id="L55">		System.setProperty(&quot;vtl.r&quot;, &quot;disable&quot;);</span>
<span class="nc" id="L56">		new CommandLine(VTLShell.class).execute(args);</span>
<span class="nc" id="L57">	}</span>

	public Void call() throws Exception
	{
<span class="nc" id="L61">		ConfigurationManager manager = ConfigurationManager.getDefault();</span>
<span class="nc" id="L62">		ENVIRONMENT_IMPLEMENTATION.setValues(</span>
				&quot;it.bancaditalia.oss.vtl.impl.environment.CSVFileEnvironment&quot;,
				&quot;it.bancaditalia.oss.vtl.impl.environment.SDMXEnvironment&quot;, 
				&quot;it.bancaditalia.oss.vtl.impl.environment.WorkspaceImpl&quot;);
		
<span class="nc" id="L67">		VTLSession session = manager.createSession();</span>
<span class="nc bnc" id="L68" title="All 2 branches missed.">		try (Reader reader = new InputStreamReader(file != null ? new FileInputStream(file) : System.in, StandardCharsets.UTF_8))</span>
		{
<span class="nc" id="L70">			session.addStatements(reader);</span>
			
<span class="nc bnc" id="L72" title="All 2 branches missed.">			if (names != null)</span>
<span class="nc bnc" id="L73" title="All 2 branches missed.">				for (String name: names)</span>
<span class="nc" id="L74">					System.out.println(session.resolve(name));</span>
			else
<span class="nc bnc" id="L76" title="All 2 branches missed.">				for (String name: session.getWorkspace().getRules().stream().map(Statement::getId).collect(toList()))</span>
<span class="nc" id="L77">					System.out.println(session.resolve(name));</span>
		}
		
<span class="nc" id="L80">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>